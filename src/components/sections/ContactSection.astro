---
import SectionHeading from "../common/SectionHeading.astro";
import { company } from "../../data/company";

const base = import.meta.env.BASE_URL;

const inquiryTypes = [
  "サービスについて",
  "採用定着プログラムについて",
  "AI研修について",
  "バックオフィス構築について",
  "その他",
];
---

<section id="contact" class="bg-navy py-32 sm:py-40">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="animate-fade-up" data-animate>
      <SectionHeading titleEn="CONTACT" titleJa="お問い合わせ" light={true} />
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-5 gap-12 lg:gap-16 animate-fade-up" data-animate>
      <!-- Left: Form (3 columns) -->
      <div class="lg:col-span-3">
        <form
          id="contact-form"
          action="https://api.web3forms.com/submit"
          method="POST"
          class="space-y-6"
        >
          <!-- Web3Forms hidden fields -->
          <input type="hidden" name="access_key" value="YOUR_ACCESS_KEY_HERE" />
          <input type="hidden" name="subject" value="SAIMONウェブサイトからのお問い合わせ" />
          <input type="hidden" name="botcheck" style="display:none" />

          <!-- 会社名 -->
          <div>
            <label for="company-name" class="block text-sm font-bold text-white/80 mb-2">
              会社名
              <span class="text-white/40 font-normal ml-1">（任意）</span>
            </label>
            <input
              type="text"
              id="company-name"
              name="company_name"
              class="w-full px-4 py-3 bg-white text-text-primary rounded-[var(--radius-button)] border-none focus:ring-2 focus:ring-teal focus:outline-none"
              placeholder="株式会社○○"
            />
          </div>

          <!-- お名前 -->
          <div>
            <label for="name" class="block text-sm font-bold text-white/80 mb-2">
              お名前 <span class="text-teal">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-3 bg-white text-text-primary rounded-[var(--radius-button)] border-none focus:ring-2 focus:ring-teal focus:outline-none"
              placeholder="山田 太郎"
            />
          </div>

          <!-- メールアドレス -->
          <div>
            <label for="email" class="block text-sm font-bold text-white/80 mb-2">
              メールアドレス <span class="text-teal">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 bg-white text-text-primary rounded-[var(--radius-button)] border-none focus:ring-2 focus:ring-teal focus:outline-none"
              placeholder="example@company.co.jp"
            />
          </div>

          <!-- お問い合わせ種別 -->
          <div>
            <label for="inquiry-type" class="block text-sm font-bold text-white/80 mb-2">
              お問い合わせ種別
            </label>
            <select
              id="inquiry-type"
              name="inquiry_type"
              class="w-full px-4 py-3 bg-white text-text-primary rounded-[var(--radius-button)] border-none focus:ring-2 focus:ring-teal focus:outline-none"
            >
              <option value="">選択してください</option>
              {inquiryTypes.map((type) => (
                <option value={type}>{type}</option>
              ))}
            </select>
          </div>

          <!-- お問い合わせ内容 -->
          <div>
            <label for="message" class="block text-sm font-bold text-white/80 mb-2">
              お問い合わせ内容 <span class="text-teal">*</span>
            </label>
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              class="w-full px-4 py-3 bg-white text-text-primary rounded-[var(--radius-button)] border-none focus:ring-2 focus:ring-teal focus:outline-none resize-vertical"
              placeholder="お問い合わせ内容をご記入ください"
            ></textarea>
          </div>

          <!-- プライバシーポリシー同意 -->
          <div class="flex items-start gap-3">
            <input
              type="checkbox"
              id="privacy-agree"
              name="privacy_agree"
              required
              class="mt-1 w-4 h-4 rounded border-white/30 text-teal focus:ring-teal focus:ring-offset-0 bg-white/10"
            />
            <label for="privacy-agree" class="text-sm text-white/70 leading-relaxed">
              <a
                href={`${base}privacy-policy/`}
                target="_blank"
                rel="noopener noreferrer"
                class="text-teal underline underline-offset-4 hover:text-teal-light transition-colors duration-200"
              >
                プライバシーポリシー
              </a>
              に同意の上、送信してください。
            </label>
          </div>

          <!-- 送信ボタン -->
          <button
            type="submit"
            class="w-full bg-teal text-white py-4 font-bold rounded-[var(--radius-button)] hover:bg-teal-light transition-colors duration-300 mt-6 cursor-pointer"
          >
            送信する
          </button>

          <!-- 送信結果表示エリア -->
          <div id="form-result" class="text-center text-sm mt-4" aria-live="polite"></div>
        </form>
      </div>

      <!-- Right: Contact Info (2 columns) -->
      <div class="lg:col-span-2">
        <h3 class="text-white font-bold text-lg mb-6">直接のご連絡</h3>

        <div class="text-white/70 text-sm space-y-4">
          <div>
            <p class="text-white/40 text-xs uppercase tracking-wider mb-1">Address</p>
            <p>{company.postalCode}</p>
            <p>{company.address}</p>
          </div>

          <div>
            <p class="text-white/40 text-xs uppercase tracking-wider mb-1">Phone</p>
            <a
              href={`tel:${company.tel}`}
              class="hover:text-teal transition-colors duration-200"
            >
              {company.tel}
            </a>
          </div>

          <div>
            <p class="text-white/40 text-xs uppercase tracking-wider mb-1">Email</p>
            <a
              href={`mailto:${company.email}`}
              class="hover:text-teal transition-colors duration-200"
            >
              {company.email}
            </a>
          </div>
        </div>

        <div class="mt-8 pt-6 border-t border-white/10">
          <p class="text-white/50 text-sm leading-relaxed">
            通常1-2営業日以内にご返信いたします。
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const contactForm = document.getElementById("contact-form") as HTMLFormElement | null;
  const resultDiv = document.getElementById("form-result");

  if (contactForm && resultDiv) {
    contactForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const submitBtn = contactForm.querySelector<HTMLButtonElement>('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = "送信中...";
      }

      try {
        const formData = new FormData(contactForm);
        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();

        if (data.success) {
          resultDiv.innerHTML =
            '<p class="text-teal font-bold">お問い合わせありがとうございます。担当者より折り返しご連絡いたします。</p>';
          contactForm.reset();
        } else {
          resultDiv.innerHTML =
            '<p class="text-red-400 font-bold">送信に失敗しました。お手数ですが、もう一度お試しください。</p>';
        }
      } catch {
        resultDiv.innerHTML =
          '<p class="text-red-400 font-bold">通信エラーが発生しました。お手数ですが、もう一度お試しください。</p>';
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = "送信する";
        }
      }
    });
  }

  // Scroll animation
  const contactElements = document.querySelectorAll<HTMLElement>('#contact [data-animate]');
  if (contactElements.length > 0) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-visible');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 }
    );
    contactElements.forEach((el) => observer.observe(el));
  }
</script>
