---
import Logo from "./Logo.astro";
import { navigation } from "../../data/navigation";

const base = import.meta.env.BASE_URL;
const navItems = navigation;
const contactItem = navItems[navItems.length - 1];
const menuItems = navItems.slice(0, -1);
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a
        href={`${base}#`}
        class="hover:opacity-80 transition-opacity"
        aria-label="SAIMON - ページトップへ"
      >
        <Logo variant="dark" class="text-2xl" />
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-1" aria-label="メインナビゲーション">
        {menuItems.map((item) => (
          <a
            href={`${base}${item.href}`}
            class="nav-link px-4 py-2 text-sm font-medium text-text-primary hover:text-navy transition-colors"
            data-nav-link
          >
            {item.labelEn}
          </a>
        ))}
        <a
          href={`${base}${contactItem.href}`}
          class="ml-4 px-6 py-2.5 bg-teal text-white text-sm font-bold rounded-lg hover:bg-teal-dark transition-colors"
          data-nav-link
        >
          {contactItem.labelEn}
        </a>
      </nav>

      <!-- Mobile Hamburger Button -->
      <button
        id="mobile-menu-toggle"
        class="lg:hidden relative z-[1000] w-10 h-10 flex flex-col items-center justify-center gap-1.5"
        aria-label="メニューを開く"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span class="hamburger-line block w-6 h-0.5 bg-navy transition-all duration-300 origin-center"></span>
        <span class="hamburger-line block w-6 h-0.5 bg-navy transition-all duration-300 origin-center"></span>
        <span class="hamburger-line block w-6 h-0.5 bg-navy transition-all duration-300 origin-center"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Fullscreen Menu -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-[999] bg-[#0d0084] flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
    aria-hidden="true"
  >
    <nav class="flex flex-col items-center gap-8" aria-label="モバイルナビゲーション">
      {navItems.map((item) => (
        <a
          href={`${base}${item.href}`}
          class="mobile-nav-link text-white text-2xl sm:text-3xl font-heading font-bold tracking-wider hover:text-teal-light transition-colors"
          data-nav-link
        >
          {item.labelEn}
          <span class="block text-white/50 text-sm font-sans font-normal mt-1 tracking-normal">
            {item.label}
          </span>
        </a>
      ))}
    </nav>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-20"></div>

<style>
  /* Header scroll state */
  #site-header.scrolled {
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.06), 0 1px 2px -1px rgb(0 0 0 / 0.06);
  }

  /* Mobile menu open state */
  #mobile-menu.menu-open {
    opacity: 1;
    pointer-events: auto;
  }

  /* Hamburger animation */
  #mobile-menu-toggle.menu-open .hamburger-line {
    background-color: white;
  }

  #mobile-menu-toggle.menu-open .hamburger-line:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
  }

  #mobile-menu-toggle.menu-open .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  #mobile-menu-toggle.menu-open .hamburger-line:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
  }
</style>

<script>
  const header = document.getElementById("site-header");
  const menuToggle = document.getElementById("mobile-menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileLinks = mobileMenu?.querySelectorAll(".mobile-nav-link");

  // Scroll effect
  if (header) {
    const updateHeader = () => {
      if (window.scrollY > 10) {
        header.classList.add("scrolled");
      } else {
        header.classList.remove("scrolled");
      }
    };
    window.addEventListener("scroll", updateHeader, { passive: true });
    updateHeader();
  }

  // Mobile menu toggle
  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener("click", () => {
      const isOpen = mobileMenu.classList.contains("menu-open");

      if (isOpen) {
        mobileMenu.classList.remove("menu-open");
        menuToggle.classList.remove("menu-open");
        menuToggle.setAttribute("aria-expanded", "false");
        menuToggle.setAttribute("aria-label", "メニューを開く");
        mobileMenu.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
      } else {
        mobileMenu.classList.add("menu-open");
        menuToggle.classList.add("menu-open");
        menuToggle.setAttribute("aria-expanded", "true");
        menuToggle.setAttribute("aria-label", "メニューを閉じる");
        mobileMenu.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }
    });

    // Close menu on link click
    mobileLinks?.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.remove("menu-open");
        menuToggle.classList.remove("menu-open");
        menuToggle.setAttribute("aria-expanded", "false");
        mobileMenu.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
      });
    });
  }
</script>
